{"name":"Haarpcache","tagline":"Fork of thundercache, haarpcache one smart cache.","body":"# HaarpCache\r\n\r\n## Maintainer\r\n- [Kei Kurono] (https://perufw.wordpress.com) <<kei.haarpcache@gmail.com>>\r\n\r\n## Table of contents\r\n- [Introduction](#introduction)\r\n- [Installing](#installing)\r\n- [Reinstall or Update](#reinstall-or-update)\r\n- [Monitoring Logs](#monitoring-logs)\r\n- [List of Plugins](#list-of-plugins)\r\n- [Changelog](#changelog)\r\n\r\n## Introduction\r\n\r\nProxy HaarpCache is a fork of ThunderCache.\r\n\r\nHaarpCache is a robust static and dynamic cache that provides support to the DASH technology.\r\n\r\n## Installing\r\n\r\n\tsu\r\n\tapt-get update \r\n\tapt-get upgrade\r\n\tapt-get install build-essential mysql-server mysql-client php5 apache2 php5-mysql \\\r\n\tlibblkid-dev libcurl4-gnutls-dev libmysqlclient15-dev libapache2-mod-auth-mysql \\\r\n\tlibapache2-mod-php5 sharutils curl autoconf squid3\r\n\tcd /usr/src/\r\n\tgit clone https://github.com/keikurono/haarpcache.git\r\n\tcd haarpcache\r\n\t./configure\r\n\tmake\r\n\tmake install\r\n\tmysql -u root -p < haarp.sql\r\n\tcd /etc/init.d\r\n\tupdate-rc.d haarp defaults 98\r\n\t\r\n\t\r\n* Create a user for database of haarpcache:\r\n\t\r\n\t\tmysql -u root -p\r\n\t\tgrant all privileges on haarp.* to haarp_user@localhost identified by 'haarpcache_password';\r\n\t\t\r\n\tChange the username ('haarp_user') and password ('haarpcache_password') for which you want.\r\n\t\r\n\r\n* Configure your /etc/haarp/haarp.conf\r\n\t\t\r\n\t\tCACHEDIR <dir_1>|<dir_2>|<dir_3> ...\t\r\n\t\tMYSQL_USER <haarp_user>\r\n\t\tMYSQL_PASS <haarpcache_password>\r\n\r\n\t`<dir_1>`, `<dir_2>`,... are the directories where cache files will be stored, for default '/haarp/'.\r\n\t`<haarp_user>` and `<haarpcache_password>` are the user and password for the database of haarpcache defined above.\r\n\r\n* Copy and paste the line above at the end of the file 'squid.conf' (or 'squid3.conf' which is in operation):\r\n\r\n\t\tacl haarp_lst url_regex -i \"/etc/haarp/haarp.lst\"\r\n\t\tcache deny haarp_lst\r\n\t\tcache_peer 127.0.0.1 parent 8080 0 proxy-only no-digest\r\n\t\tdead_peer_timeout 2 seconds\r\n\t\tcache_peer_access 127.0.0.1 allow haarp_lst\r\n\t\tcache_peer_access 127.0.0.1 deny all\r\n\t\t\r\n* Below the line of the `http_port` configuration, add: \r\n\r\n\t\tacl google url_regex -i (googlevideo.com|www.youtube.com)\r\n\t\tacl iphone browser -i regexp (iPhone|iPad)\r\n\t\tacl BB browser -i regexp (BlackBerry|PlayBook)\r\n\t\tacl Winphone browser -i regexp (Windows.*Phone|Trident|IEMobile)\r\n\t\tacl Android browser -i regexp Android\r\n\t\trequest_header_access User-Agent deny google !iphone !BB !Winphone !Android\r\n\t\trequest_header_replace User-Agent Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)\r\n\twith this we avoid the redirects `HTTP` to `HTTPS` in `youtube.com`. Only works for PC's, and when you enter to `http://www.youtube.com` from the address bar (of your browser) or from `www.google.com`.\r\n\r\n* On squid.conf Comment the line:\r\n\t\t\r\n\t\t#hierarchy_stoplist cgi-bin ?\r\n\r\n* On crontab add the line:\r\n\t\r\n\t\t50 12     * * *   root    /etc/init.d/haarpclean\r\n\r\n* View reports of your cache system:\r\n\r\n\t\tcp /usr/src/haarpcache/etc/haarp/haarp.php /var/www/\r\n\t\r\n\tChange the line 24 of the file haarp.php with your user and password for your database haarpcache.\r\n\t\r\n\t\t if (!( $db = new PDO('mysql:host=localhost;dbname=haarp', 'haarp_user','haarpcache_password') ) )\r\n\r\n* Your viewer:\r\n\r\n\t\thttp://<IP_Your_Server>/haarp.php\r\n\r\n* Security:\r\n\t\r\n\t\tiptables -I INPUT 1 -i <eth_wan_1> -m tcp -p tcp --dport 8080 -m state --state NEW -j DROP\r\n\t\tiptables -I INPUT 1 -i <eth_wan_2> -m tcp -p tcp --dport 8080 -m state --state NEW -j DROP\r\n\t\t...\r\n\t\r\n\tThe port 8080 is of your haarpcache server. You can change this editing the file /etc/haarp/haarp.conf. \r\n\r\n* Avoid the `QUIC` protocol connections on `www.youtube.com`\r\n\r\n\t\tiptables -A FORWARD -i <eth_lan> -p udp -m udp --dport 80 -j REJECT --reject-with icmp-port-unreachable\r\n\t\t\r\n\tadd the following line in `squid.conf`:\r\n\t\r\n\t\t# Disable alternate protocols\r\n\t\treply_header_access Alternate-Protocol deny all\r\n\t\t\r\n* All iptables rules should be placed in a *.sh file to be executed whenever the computer is started.\r\n\r\n* Finally:\r\n \t\r\n\t\t/etc/init.d/haarp restart\r\n\t\tsquid -k reconfigure\r\n\t\t\r\n* Handling QoS can be done by making a marking of packages based on the search for the string \"X-Cache: HIT from HAARP\" or \"HAARP: HIT from\" in the packet header. Thus a possible handling may carried out as follows:\r\n\r\n\t\tIF_LAN=eth0\r\n\t\tMAX_DOWN=1300kbps\r\n\t\tMIN_CACHE_DOWN=1000kbps\r\n\t\tMAX_CACHE_DOWN=1100kbps\r\n\t\t \r\n\t\tiptables -A OUTPUT -t mangle -o $IF_LAN -p tcp -m string --string \"X-Cache: HIT from Haarp\" --algo kmp -j MARK --set-mark 666\r\n\t\t \r\n\t\ttc qdisc add dev $IF_LAN root handle 1:0 htb default 10 r2q 15\r\n\t\ttc class add dev $IF_LAN parent 1:0 classid 1:1 htb rate $MAX_DOWN ceil $MAX_DOWN\r\n\t\ttc class add dev $IF_LAN parent 1:1 classid 1:66 htb rate $MIN_CACHE_DOWN ceil $MAX_CACHE_DOWN\r\n\t\ttc qdisc add dev $IF_LAN parent 1:66 handle 66:0 sfq perturb 30\r\n\t\ttc filter add dev $IF_LAN protocol ip parent 1:0 handle 666 fw classid 1:66\r\n\t\t\r\n\r\n## Reinstall or Update\r\n\r\nFor a common update:\r\n\t\r\n\t\tsu\r\n\t\tcd /usr/src/\r\n\t\tgit clone https://github.com/keikurono/haarpcache.git\r\n\t\tcd haarpcache\r\n\t\t./configure\r\n\t\tmake\r\n\t\tmake install\r\n\t\tcp -b etc/haarp/haarp.lst /etc/haarp/haarp.lst\r\n\t\t/etc/init.d/haarp restart\r\n\t\tsquid -k reconfigure\r\n\t\r\n## Monitoring Logs\r\n\r\nDepending on the location of the logs defined in the file `/etc/haarp/haarp.conf`:\r\n\r\n\t\ttail -f /var/log/haarp/access.log\r\n\t\ttail -f /var/log/haarp/error.log\r\n\r\nLevel information in the logs: change the `LOGLEVEL` on `/etc/haarp/haarp.conf`.\r\n\r\n## List of Plugins\r\n\r\n* Currently Haarp supports:\r\n\r\n\r\n\tYoutube (https not supported),\r\n\tNetflix (Video and Images),\r\n\tDoubleClick (Block of ADS),\r\n\tGooglevideo,\r\n\tDailymotion,\r\n\tAOL,\r\n\tVimeo,\r\n\tMetacafe,\r\n\tModovideo,\r\n\tBitgravity,\r\n\tGlobo,\r\n\tTerra,\r\n\tViddler,\r\n\tJustin,\r\n\tEdgecastcdn,\r\n\tYouku,\r\n\tWrzuta,\r\n\t5min,\r\n\tViddler,\r\n\tTumblr,\r\n\tFacebook (https not supported);\r\n\t\r\n\tBomusica,\r\n\tBullafina,\r\n\tCoqui,\r\n\tCutmu,\r\n\tDomusica,\r\n\tDomusicas,\r\n\tDungeonbusters,\r\n\tGoobeo,\r\n\tGooveo,\r\n\tMiniclip,\r\n\tMolenillo,\r\n\tMp3-Buscador,\r\n\tMusicaveo,\r\n\tNing,\r\n\tNofeehost,\r\n\tSonicomusica,\r\n\tTurner,\r\n\tVevos;\r\n\t\r\n\t4shared,\r\n\tMediafire,\r\n\tEtrustdownloads,\r\n\tZiddu;\r\n\t\r\n\tAkamaihd,\r\n\tAmazonaws,\r\n\tBlogspot,\r\n\tImageshack,\r\n\tIssuu,\r\n\tMercadolibre,\r\n\tSubmanga,\r\n\tYtimg;\r\n\t\r\n\tAvast,\r\n\tAvgate,\r\n\tEset,\r\n\tMcafee,\r\n\tAvira,\r\n\tBitdefender;\r\n\r\n\tWindowsupdate,\r\n\tAdobe;\r\n\t\r\n\tPorntube,\r\n\tXvideos,\t\r\n\tPornhub,\r\n\tRedtube,\r\n\tYouPorn,\r\n\tServiporno,\r\n\tTube8;\r\n\t\r\n\tAppspot,\r\n\tCloudfront,\r\n\tJuegosdiarios,\r\n\tJuegosjuegos,\r\n\tNetpocket,\r\n\tNordeus,\r\n\tPopcap,\r\n\tSocialpointgames,\r\n\tTelaxo,\r\n\tTetrisfb,\r\n\tVostucdn,\r\n\tWooga,\r\n\tZgncdn;\r\n\t\r\n\tDisneylatino,\r\n\tFriv,\r\n\tGeewa,\r\n\tHulkshare,\r\n\tKixeye,\r\n\tLlnwd,\r\n\tMaguinamotors,\r\n\tManabar;\r\n\t\r\n\tSpeedTest;\r\n\t\r\n\r\nConfigure your file /etc/haarp/haarp.lst to disable or enable the plugins.\t\r\n\r\n\t\r\n## Changelog\r\n\r\n__Version 1.4.1__\r\n\r\n2015/07/31\r\n\r\n* Update the plugins for edgecastcdn, socialpointgames and akamaihd.\r\n* Update plugin of Youtube: not cached of videos on live.\r\n* Using the parameter ‘clen’ of the url from youtube as file size.\r\n* Update the HaarpClean program.\r\n* Fixed the problem of bad replacement string in the SQL requests.\r\n* Update the file of configuration for logrotate.\r\n* Fix problem: ‘general protection ip:7f39b6cdd44e sp:7ffc278771f0 error:0 in libmysqlclient.so.18.0.0‘.\r\n\r\n__Version 1.4__\r\n\r\n2015/07/07\r\n\r\n* Adding 50 new plugins.\r\n* Improved support for DASH technology.\r\n* Update the file of configuration for logrotate.\r\n* Fix problem: 'segfault at 6 ip 00007f850c2cef36 sp 00007fff19f22d00 error 4 in libmysqlclient.so.18.1.0'.\r\n* Fix problem: 'Error in /usr/local/sbin/haarp: free(): invalid pointer: 0x00007fb5e166d618'.\r\n\r\n__Version 1.3__\r\n\r\n2015/06/13\r\n\r\n* Fix Problem with concurrent caching of files.\r\n* Update the plugin Youtube. \r\n\r\n__Version 1.2.1__\r\n_Thanks to Samuel Espinoza, Oscar Vaquero y Fernando Maniglia._\r\n\r\n2015/05/29\r\n\r\n* Fix concurrent caching of files.\r\n* Update haarpclean script.\r\n* Update some plugins: Youtube, Dailymotion, 4shared, Issuu, Avgate, Submanga, YourPorn, PornHub, Xvideos, PornTube, Tube8. \r\n* Files of youtube are cached with the watch ID from the URL.\r\n\r\n__Version 1.2__\r\n\r\n2013/12/24\r\n\r\n* Improved ad-blocking plugin for Youtube.\r\n* Update plugins: globo.com, youtube.com.\r\n* Differentiation of the header for the chrome browser.\r\n* Update of haarpclean script for the cleaning the cache.\r\n* Synchronous to the storage of the cache in an only file.\r\n\r\n__Version 1.1__\r\n\r\n2013/02/09\r\n\r\n* Cache dynamic and intelligent.\r\n* Update of plugins for the smart operation.\r\n* Multidisc.\r\n* Blocking advertising to Youtube.\r\n* Cache of videos in html5 for Youtube.\r\n\r\nFork created by\r\n\r\nManolo Canales\r\n\r\nkei.haarpcache@gmail.com\r\n\r\nhttp://perufw.wordpress.com\r\n\r\n<br/>\r\n<div align=\"center\">\r\n<p><h6>If you find this code useful, or wish to fund further development,\r\nyou can use PayPal to donate to the HaarpCache project:</h6>\r\n<a href=\"https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&amp;hosted_button_id=QYCCSYYGW52QU\"><img src=\"https://www.paypalobjects.com/en_US/i/btn/btn_donateCC_LG.gif\"></a>\r\n</div>\r\n    \r\n  </body>\r\n</html>\r\n","google":"UA-63531854-1","note":"Don't delete this file! It's used internally to help with page regeneration."}